var strObj = {
  "01": {
    name: "La Mirada",
    address: "14501 Artesia Blvd<br> La Mirada, CA 90638",
    link: "/store/MapRedirector?storeId=01",
    cord: [33.8734, -118.02169]
  },
  "03": {
    name: "Van Nuys",
    address: "14400 Arminta St<br> Panorama City, CA 91402",
    link: "/store/MapRedirector?storeId=03",
    cord: [34.21226, -118.44665]
  },
  "04": {
    name: "Irvine",
    address: "101 Technology Dr<br> Irvine, CA 92618",
    link: "/store/MapRedirector?storeId=04",
    cord: [33.65767, -117.74235]
  },
  "05": {
    name: "Monrovia",
    address: "407 W Huntington Dr<br> Monrovia, CA 91016",
    link: "/store/MapRedirector?storeId=05",
    cord: [34.14115, -118.00767]
  },
  "06": {
    name: "Redondo Beach",
    address: "1519 Hawthorne Blvd<br> Redondo Beach, CA 90278",
    link: "/store/MapRedirector?storeId=06",
    cord: [33.86846, -118.35565]
  },
  "07": {
    name: "Menifee",
    address: "30251 Antelope Rd<br> Menifee, CA 92584",
    link: "/store/MapRedirector?storeId=07",
    cord: [33.681759, -117.169319]
  },
  "08": {
    name: "Vista",
    address: "1900 University Dr<br> Vista, CA 92083",
    link: "/store/MapRedirector?storeId=08",
    cord: [33.17137, -117.21879]
  },
  "09": {
    name: "Mission Valley",
    address: "8730 Rio San Diego<br> San Diego, CA 92108",
    link: "/store/MapRedirector?storeId=09",
    cord: [32.77623, -117.14286]
  },
  "10": {
    name: "Scottsdale",
    address: "16275 N Scottsdale Rd<br> Scottsdale, AZ 85260",
    link: "/store/MapRedirector?storeId=10",
    cord: [33.63324, -111.88978]
  },
  "11": {
    name: "Phoenix",
    address: "6600 W. Latham<br> Phoenix, AZ 85043",
    link: "/store/MapRedirector?storeId=11",
    cord: [33.46084, -112.15122]
  },
  "12": {
    name: "Huntington Beach",
    address: "6912 Edinger Ave<br> Huntington Beach, CA 92647",
    link: "/store/MapRedirector?storeId=12",
    cord: [33.72842, -118.00798]
  },
  "13": {
    name: "Mid City Los Angeles",
    address: "4801 Venice Blvd<br> Los Angeles, CA 90019",
    link: "/store/mapredirector?storeId=13",
    cord: [34.04669, -118.34202]
  },
  "14": {
    name: "Fremont",
    address: "49088 Fremont Blvd<br> Fremont, CA 94537",
    link: "/store/MapRedirector?storeId=14",
    cord: [37.45681, -121.92517]
  },
  "15": {
    name: "Gilbert",
    address: "2300 Santan Village Pkwy<br> Gilbert, AZ 85297",
    link: "/store/MapRedirector?storeId=15",
    cord: [33.3086, -111.74706]
  },
  "16": {
    name: "San Leandro",
    address: "250 Floresta Blvd<br> San Leandro, CA 94578",
    link: "/store/MapRedirector?storeId=16",
    cord: [37.70077, -122.14157]
  },
  "17": {
    name: "Glendale",
    address: "6767 W. Bell Road<br> Glendale, AZ 85308",
    link: "/store/MapRedirector?storeId=17",
    cord: [33.6364, -112.20401]
  },
  "18": {
    name: "Summerlin",
    address: "700 S. Rampart Blvd<br> Las Vegas, NV 89145",
    link: "/store/MapRedirector?storeId=18",
    cord: [36.16295, -115.28714]
  },
  "19": {
    name: "Millbrae",
    address: "855 Broadway<br> Millbrae, CA 94030",
    link: "/store/MapRedirector?storeId=19",
    cord: [37.60403, -122.39613]
  },
  "20": {
    name: "Pflugerville",
    address: "19024 N. Heatherwilde<br> Pflugerville, TX 78660",
    link: "/store/MapRedirector?storeId=20",
    cord: [30.48126, -97.61514]
  },
  "21": {
    name: "San Antonio",
    address: "4239 N Loop 1604 W.<br> San Antonio, TX 78249",
    link: "/store/MapRedirector?storeId=21",
    cord: [29.589896, -98.602126]
  },
  "22": {
    name: "Grand Prairie",
    address: "1514 Arkansas Ln<br> Grand Prairie, TX 75051",
    link: "/store/MapRedirector?storeId=22",
    cord: [32.706561, -97.027073]
  },
  "23": {
    name: "San Jose",
    address: "5540 Winfield Blvd<br> San Jose, CA 95123",
    link: "/store/MapRedirector?storeId=23",
    cord: [37.2524991, -121.86597]
  },
  "28": {
    name: "Perris Outlet",
    address: "18810 Harvill Ave<br> Perris, CA 92570",
    link: "/store/MapRedirector?storeId=28",
    cord: [33.8469641, -117.2576937]
  },
  "88": {
    name: "Rancho Cucamonga",
    address: "12649 Foothill Blvd<br> Rancho Cucamonga, CA 91739",
    link: "/store/MapRedirector?storeId=88",
    cord: [34.10402, -117.5292]
  },
  "80": {
    name: "Grand Prairie DC",
    address: "1514 Arkansas Ln<br> Grand Prairie, TX 75051",
    link: "/store/MapRedirector?storeId=80",
    cord: [32.7066334, -97.0294506]
  },
  "81": {
    name: "Perris DC",
    address: "18810 Harvill Ave<br> Perris, CA 92570",
    link: "/store/MapRedirector?storeId=81",
    cord: [33.8469641, -117.2576937]
  },
  "94": {
    name: "Fremont DC",
    address: "41088 Boyce Rd<br> Fremont, CA 94538",
    link: "/store/MapRedirector?storeId=94",
    cord: [37.512052, -121.9920647]
  },
  "97": {
    name: "Phoenix DC",
    address: "6600 W Latham<br> Phoenix, AZ 85043",
    link: "/store/MapRedirector?storeId=97",
    cord: [33.4613254, -112.2014702]
  },
  "99": {
    name: "Rialto DC",
    address: "3994 S Riverside Ave<br> Colton, CA 92324",
    link: "/store/MapRedirector?storeId=99",
    cord: [34.0281458, -117.3705067]
  }
};

var busInterval = setInterval(function() {
  if (
    typeof window.EventBus !== "undefined" &&
    typeof window.jQuery !== "undefined" &&
    typeof utag_data !== "undefined"
  ) {
    if (utag_data["cp.utag_main__sn"] == "1") {
      clearInterval(busInterval);
      window.EventBus.$on("acceptedGeolocation", function() {
        $("body").append(
          '<section id="geoModal"> <div class="modal fade" id="geo_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"> <div class="modal-dialog" role="document"> <div class="modal-content"> <div class="modal-body"> <button type="button" class="close geo_close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button> <div class="round_wrapper"> <h3><i class="fa fa-check" aria-hidden="true"></i> Location Enabled</h3> </div> <div id="geo_location" class="location"> </div> <div class="footer_wrapper"> <p>We will personalize your website experience to reflect this store and your specific delivery options.</p> <span class="close_btn" type="button" data-dismiss="modal">X Close</span> </div> </div> </div> </div> </div> </section>'
        );
        setTimeout(getGeolocation, 500);
      });
    } else {
      clearInterval(busInterval);
    }
  }
}, 50);

function getGeolocation() {
  if (window.$.cookie("lsf-my-store-id") == undefined) {
    getGeolocation();
  } else {
    var options = {
      enableHighAccuracy: true,
      timeout: 5000,
      maximumAge: 0
    };
    window.navigator.geolocation.getCurrentPosition(success, error, options);
  }
}
function success(pos) {
  var crd = pos.coords;
  var selectedStore = window.$.cookie("lsf-my-store-id");
  var coordinates = strObj[selectedStore].cord;
  var distance = findDistance(
    crd.latitude,
    crd.longitude,
    coordinates[0],
    coordinates[1]
  );

  var storeMiles =
    Math.floor(distance) > 1 ? "(" + Math.floor(distance) + "miles)" : "";

  $("#geo_location").append(
    '<p><i class="fa fa-map-marker" aria-hidden="true"></i> Your Nearest Store:</p> <p id="geo_str_name"><strong>' +
      strObj[selectedStore].name +
      "</strong> " +
      storeMiles +
      '</p> <p id="geo_str_address">' +
      strObj[selectedStore].address +
      '</p> <a id="geo_direction_link" target="_blank" href="' +
      strObj[selectedStore].link +
      '">Directions &rsaquo;</a>'
  );
  window.$("#geo_modal").modal("show");
}

function error(err) {
  console.debug(err.code, err.message);
}

function findDistance(lat1, lon1, lat2, lon2, unit) {
  if (lat1 == lat2 && lon1 == lon2) {
    return 0;
  } else {
    var radlat1 = (Math.PI * lat1) / 180;
    var radlat2 = (Math.PI * lat2) / 180;
    var theta = lon1 - lon2;
    var radtheta = (Math.PI * theta) / 180;
    var dist =
      Math.sin(radlat1) * Math.sin(radlat2) +
      Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
    if (dist > 1) {
      dist = 1;
    }
    dist = Math.acos(dist);
    dist = (dist * 180) / Math.PI;
    dist = dist * 60 * 1.1515;
    if (unit == "K") {
      dist = dist * 1.609344;
    }
    if (unit == "N") {
      dist = dist * 0.8684;
    }
    return dist;
  }
}
